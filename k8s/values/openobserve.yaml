# ============================================================================
# OPENOBSERVE ENTERPRISE VALUES (0.20.1 - CNPG)
# ============================================================================

image:
  repository: public.ecr.aws/zinclabs/openobserve
  tag: "v0.23.2" 

enterprise:
  enabled: true
  repository: public.ecr.aws/zinclabs/openobserve-enterprise
  tag: "v0.23.2"

# ----------------------------------------------------------------------------
# 1. DATABASE (CloudNativePG)
# ----------------------------------------------------------------------------
# IMPORTANT: "postgres" block triggers CNPG creation in 0.20.1
postgres:
  enabled: true
  pgadmin:
    enabled: false
  spec:
    # Password is injected dynamically via Terraform main.tf
    # password: <INJECTED> 
    
    enableSuperuserAccess: true
    instances: 2
    storage:
      size: 10Gi
    # Resource limits for local dev
    resources:
      requests: { memory: 256Mi, cpu: 100m }
      limits: { memory: 512Mi }

# Disable legacy Bitnami Postgres if present
postgresql:
  enabled: false

# ----------------------------------------------------------------------------
# 2. DISABLE BUILT-IN MINIO (We use standalone official chart)
# ----------------------------------------------------------------------------
minio:
  enabled: false

# ----------------------------------------------------------------------------
# 3. COMPONENT TOGGLES
# ----------------------------------------------------------------------------
etcd:
  enabled: false
openfga:
  enabled: false

# ----------------------------------------------------------------------------
# 4. CONFIGURATION & RESOURCES (Slim Profile)
# ----------------------------------------------------------------------------
ingester:
  replicas: 1
  resources:
    requests: { cpu: 50m, memory: 128Mi }
    limits: { memory: 512Mi }
querier:
  replicas: 1
  resources:
    requests: { cpu: 50m, memory: 128Mi }
    limits: { memory: 512Mi }
compactor:
  replicas: 1
  resources:
    requests: { cpu: 50m, memory: 128Mi }
    limits: { memory: 512Mi }
router:
  replicas: 1
  resources:
    requests: { cpu: 50m, memory: 64Mi }
    limits: { memory: 256Mi }
alertmanager:
  replicas: 1
  resources:
    requests: { cpu: 50m, memory: 64Mi }
    limits: { memory: 256Mi }

statefulSet:
  enabled: true
  replicas: 1

config:
  ZO_META_STORE: 'db'
  ZO_S3_BUCKET_NAME: 'openobserve-data'

extraEnv:
  - name: AWS_EC2_METADATA_DISABLED
    value: "true"
  - name: ZO_LOCAL_MODE
    value: "false"
  - name: ZO_TELEMETRY
    value: "false"
  - name: ZO_PROMETHEUS_ENABLED
    value: "true"
  - name: ZO_HA_MODE
    value: "true"
  - name: ZO_ENTERPRISE_MODE
    value: "true"
  - name: ZO_TRACES_SPAN_METRICS_ENABLED
    value: "true"
  - name: ZO_TRACING_ENABLED
    value: "true"
  - name: ZO_USAGE_REPORTING_ENABLED
    value: "true"
  - name: ZO_S3_REGION_NAME
    value: "eu-central-1"
  - name: ZO_S3_ALLOW_INVALID_CERTIFICATES
    value: "true"

  # S3 Provider Explicit Config
  - name: ZO_S3_PROVIDER
    value: "minio"
  # Service name for Official MinIO chart
  - name: ZO_S3_SERVER_URL
    value: "http://minio.o2-system.svc:9000"

  # Credentials Injection
  - name: ZO_ROOT_USER_EMAIL
    valueFrom: { secretKeyRef: { name: o2-platform-secret, key: ZO_ROOT_USER_EMAIL } }
  - name: ZO_ROOT_USER_PASSWORD
    valueFrom: { secretKeyRef: { name: o2-platform-secret, key: ZO_ROOT_USER_PASSWORD } }
  - name: ZO_S3_ACCESS_KEY
    valueFrom: { secretKeyRef: { name: o2-platform-secret, key: ZO_S3_ACCESS_KEY } }
  - name: ZO_S3_SECRET_KEY
    valueFrom: { secretKeyRef: { name: o2-platform-secret, key: ZO_S3_SECRET_KEY } }
  - name: ZO_META_POSTGRES_DSN
    valueFrom: { secretKeyRef: { name: o2-platform-secret, key: ZO_META_POSTGRES_DSN } }
  - name: ZO_TRACING_HEADER_VALUE
    valueFrom: { secretKeyRef: { name: o2-platform-secret, key: ZO_TRACING_HEADER_VALUE } }